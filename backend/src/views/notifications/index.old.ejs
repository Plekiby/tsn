<!doctype html>
<html>
  <body>
    <%- include("../partials/topnav", { unreadCount }) %>
    <h2>Notifications</h2>

    <form method="POST" action="/notifications/read-all">
      <button type="submit">Tout marquer comme lu</button>
    </form>

    <hr />

    <h3>Invitations de groupe</h3>

    <% if (!groupInvites || groupInvites.length === 0) { %>
      <p>Aucune invitation.</p>
    <% } else { %>
      <% groupInvites.forEach(inv => { %>
        <div style="border:1px solid #ddd; padding:10px; margin:10px 0;">
          <div>
            <strong><%= inv.fromUser.displayName %></strong>
            t’a invité dans le groupe
            <strong><%= inv.group.name %></strong>
          </div>

          <div style="font-size:12px; opacity:0.7; margin-top:6px;">
            <%= new Date(inv.createdAt).toLocaleString() %>
          </div>

          <div style="margin-top:8px;">
            <form method="POST" action="/groups/invites/<%= inv.id %>/accept" style="display:inline;">
              <button type="submit">Accepter</button>
            </form>

            <form method="POST" action="/groups/invites/<%= inv.id %>/refuse" style="display:inline; margin-left:8px;">
              <button type="submit">Refuser</button>
            </form>
          </div>
        </div>
      <% }) %>
    <% } %>

    <hr />

    <% if (!notifications || notifications.length === 0) { %>
      <p>Aucune notification.</p>
    <% } %>

    <% (notifications || []).forEach(n => { %>
      <div style="border:1px solid #ddd; padding:10px; margin:10px 0; background:<%= n.readAt ? '#fff' : '#f7f7ff' %>;">
        <div style="font-size:12px; opacity:0.7;">
          <%= new Date(n.createdAt).toLocaleString() %>
          <% if (!n.readAt) { %> • <strong>NEW</strong><% } %>
        </div>

        <% if (n.event) { %>
          <div style="margin-top:6px; font-size:12px; opacity:0.8;">
            Event: <%= n.event.title %>
          </div>
        <% } %>

        <div style="margin-top:6px;">
          <strong><%= n.type %></strong>
          <% if (n.fromUser) { %> — <%= n.fromUser.displayName %><% } %>
        </div>

        <% if (n.post) { %>
          <div style="margin-top:6px; font-size:12px; opacity:0.8;">
            Post: <%= n.post.content.slice(0, 80) %>
          </div>
        <% } %>

        <% if (n.comment) { %>
          <div style="margin-top:6px;">
            Comment: <%= n.comment.content %>
          </div>
        <% } %>
      </div>
    <% }) %>
  </body>
</html>
