<%- include("../partials/header", { pageTitle: "Centres d'intérêt", unreadCount, unreadMessages, user }) %>

<div class="container my-4">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">
        <i class="bi bi-tag"></i> Centres d'intérêt
      </h2>

      <!-- Mes intérêts sélectionnés -->
      <div class="card mb-4 border-primary">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-star-fill"></i> Mes intérêts (<span id="count-selected"><%= mySet.size %></span>)</h5>
        </div>
        <div class="card-body">
          <div id="my-interests" class="d-flex flex-wrap gap-2">
            <% if (mySet.size === 0) { %>
              <p class="text-muted mb-0">Aucun intérêt sélectionné. Choisissez-en ci-dessous !</p>
            <% } else { %>
              <% interests.filter(i => mySet.has(i.id)).forEach(i => { %>
                <form method="POST" action="/interests/<%= i.id %>/toggle" style="display: inline;">
                  <button type="submit" class="btn btn-primary btn-sm">
                    <%= i.name %> <i class="bi bi-x-circle ms-1"></i>
                  </button>
                </form>
              <% }) %>
            <% } %>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <!-- Barre de recherche -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="input-group">
            <span class="input-group-text bg-white">
              <i class="bi bi-search"></i>
            </span>
            <input
              type="text"
              class="form-control"
              id="search-interests"
              placeholder="Rechercher un intérêt (ex: football, programmation, anime...)"
              autocomplete="off"
            />
          </div>
          <small class="text-muted d-block mt-2">
            <span id="count-filtered"><%= interests.length %></span> intérêt(s) trouvé(s)
          </small>
        </div>
      </div>

      <!-- Créer un nouvel intérêt -->
      <div class="card mb-4 border-success">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Créer un nouvel intérêt</h5>
        </div>
        <div class="card-body">
          <form method="POST" action="/interests">
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                name="name"
                placeholder="Nom de votre intérêt personnalisé"
                required
                minlength="2"
                maxlength="50"
              />
              <button type="submit" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> Créer et ajouter
              </button>
            </div>
            <small class="text-muted d-block mt-2">
              Si vous ne trouvez pas votre intérêt dans la liste, créez-le ici !
            </small>
          </form>
        </div>
      </div>

      <hr class="my-4">

      <!-- Liste des intérêts disponibles -->
      <div>
        <h3 class="h5 mb-3">
          <i class="bi bi-grid-3x3-gap"></i> Tous les intérêts disponibles
        </h3>

        <div class="row g-2" id="interests-list">
          <% interests.forEach(i => { %>
            <% const selected = mySet.has(i.id); %>
            <% if (!selected) { %>
              <div class="col-6 col-md-4 col-lg-3 interest-item" data-name="<%= i.name.toLowerCase() %>">
                <form method="POST" action="/interests/<%= i.id %>/toggle">
                  <button type="submit" class="btn btn-outline-secondary btn-sm w-100 text-start">
                    <i class="bi bi-plus-circle me-1"></i> <%= i.name %>
                  </button>
                </form>
              </div>
            <% } %>
          <% }) %>
        </div>

        <div id="no-results" class="alert alert-info mt-3" style="display: none;">
          <i class="bi bi-info-circle"></i> Aucun intérêt trouvé. Essayez de créer le vôtre ci-dessus !
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .interest-tag {
    background-color: #0d6efd;
    color: white;
    padding: 0.35rem 0.65rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
  }

  .gap-2 {
    gap: 0.5rem !important;
  }

  .interest-item {
    transition: transform 0.2s;
  }

  .interest-item:hover {
    transform: translateY(-2px);
  }
</style>

<script>
  const searchInput = document.getElementById('search-interests');
  const interestItems = document.querySelectorAll('.interest-item');
  const noResults = document.getElementById('no-results');
  const countFiltered = document.getElementById('count-filtered');

  searchInput.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase().trim();
    let visibleCount = 0;

    interestItems.forEach(item => {
      const name = item.getAttribute('data-name');
      if (name.includes(searchTerm)) {
        item.style.display = '';
        visibleCount++;
      } else {
        item.style.display = 'none';
      }
    });

    countFiltered.textContent = visibleCount;
    noResults.style.display = visibleCount === 0 && searchTerm !== '' ? 'block' : 'none';
  });
</script>

<%- include("../partials/footer") %>
