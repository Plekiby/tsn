<%- include("../partials/header", { pageTitle: "√âditer mon profil", unreadCount, unreadMessages, user }) %>

<div class="container-fluid my-4" style="max-width: 900px;">
  <div class="row">
    <div class="col-12 px-2 px-md-0">
      <div class="mb-3">
        <a href="/profiles/<%= profile.id %>" class="btn btn-outline-primary btn-sm">
          <i class="bi bi-arrow-left"></i> Retour au profil
        </a>
      </div>

      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0"><i class="bi bi-pencil-square"></i> √âditer mon profil</h4>
        </div>
        <div class="card-body">
          <form method="POST" action="/profiles/<%= profile.id %>/edit" enctype="multipart/form-data">
            <!-- Infos principales -->
            <div class="row">
              <div class="col-12 col-md-6 mb-3">
                <label for="displayName" class="form-label">
                  Nom affich√© <span class="text-danger">*</span>
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="displayName"
                  name="displayName"
                  value="<%= profile.displayName || '' %>"
                  required
                />
              </div>

              <div class="col-12 col-md-6 mb-3">
                <label for="location" class="form-label">
                  <i class="bi bi-geo-alt"></i> Localisation
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="location"
                  name="location"
                  value="<%= profile.location || '' %>"
                  maxlength="100"
                  placeholder="Ville, Pays"
                />
              </div>
            </div>

            <!-- Bio -->
            <div class="mb-3">
              <label for="bio" class="form-label">Bio</label>
              <textarea
                class="form-control"
                id="bio"
                name="bio"
                rows="4"
                maxlength="500"
                placeholder="Parlez de vous..."
              ><%= profile.bio || '' %></textarea>
              <div class="form-text">Max 500 caract√®res</div>
            </div>

            <div class="row">
              <div class="col-12 col-md-6 mb-3">
                <label for="website" class="form-label">
                  <i class="bi bi-link-45deg"></i> Site web
                </label>
                <input
                  type="url"
                  class="form-control"
                  id="website"
                  name="website"
                  value="<%= profile.website || '' %>"
                  maxlength="200"
                  placeholder="https://example.com"
                />
              </div>

              <div class="col-12 col-md-6 mb-3">
                <label for="dateOfBirth" class="form-label">
                  <i class="bi bi-cake"></i> Date de naissance
                </label>
                <input
                  type="date"
                  class="form-control"
                  id="dateOfBirth"
                  name="dateOfBirth"
                  value="<%= profile.dateOfBirth ? new Date(profile.dateOfBirth).toISOString().split('T')[0] : '' %>"
                />
              </div>
            </div>

            <hr class="my-4">

            <!-- Privacy Settings -->
            <div class="mb-4">
              <h5 class="mb-3">
                <i class="bi bi-shield-lock"></i> Param√®tres de confidentialit√©
              </h5>

              <div class="mb-3">
                <label for="profileVisibility" class="form-label">
                  Qui peut voir mon profil ?
                </label>
                <select class="form-select" id="profileVisibility" name="profileVisibility">
                  <option value="PUBLIC" <%= profile.privacy?.profileVisibility === 'PUBLIC' ? 'selected' : '' %>>
                    üåç Public - Tout le monde peut voir mon profil
                  </option>
                  <option value="FOLLOWERS" <%= profile.privacy?.profileVisibility === 'FOLLOWERS' ? 'selected' : '' %>>
                    üë• Abonn√©s - Seulement mes abonn√©s
                  </option>
                  <option value="PRIVATE" <%= profile.privacy?.profileVisibility === 'PRIVATE' ? 'selected' : '' %>>
                    üîí Priv√© - Seulement moi
                  </option>
                </select>
                <div class="form-text">Contr√¥lez qui peut acc√©der √† votre profil</div>
              </div>

              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="canReceiveMessages"
                  name="canReceiveMessages"
                  value="true"
                  <%= profile.privacy?.canReceiveMessages ? 'checked' : '' %>
                />
                <label class="form-check-label" for="canReceiveMessages">
                  Autoriser les messages directs
                </label>
                <div class="form-text">Permettre aux autres utilisateurs de vous envoyer des messages</div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Avatar -->
            <div class="mb-4">
              <label class="form-label fw-bold mb-2">
                <i class="bi bi-image"></i> Avatar
              </label>
              <div class="mb-3">
                <% if (profile.avatar) { %>
                  <img src="<%= profile.avatar %>" alt="Avatar" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
                <% } else { %>
                  <div class="d-flex align-items-center justify-content-center bg-light rounded-circle" style="width: 100px; height: 100px;">
                    <i class="bi bi-person-circle text-muted" style="font-size: 2rem;"></i>
                  </div>
                <% } %>
              </div>
              <label for="avatar" class="form-label">Nouveau avatar (max 5MB)</label>
              <input
                type="file"
                class="form-control"
                id="avatar"
                name="avatar"
                accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
              />
              <small class="form-text">Format: JPEG, PNG, GIF ou WebP</small>
            </div>

            <!-- Banner -->
            <div class="mb-4">
              <label class="form-label fw-bold mb-2">
                <i class="bi bi-image"></i> Banni√®re
              </label>
              <div class="mb-3">
                <% if (profile.banner) { %>
                  <img src="<%= profile.banner %>" alt="Banner" class="w-100 rounded" style="max-height: 150px; object-fit: cover;">
                <% } else { %>
                  <div class="d-flex align-items-center justify-content-center bg-light rounded" style="width: 100%; height: 120px;">
                    <span class="text-muted"><i class="bi bi-image"></i> Aucune banni√®re</span>
                  </div>
                <% } %>
              </div>
              <label for="banner" class="form-label">Nouvelle banni√®re (max 5MB)</label>
              <input
                type="file"
                class="form-control"
                id="banner"
                name="banner"
                accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
              />
              <small class="form-text">Format: JPEG, PNG, GIF ou WebP</small>
            </div>

            <hr class="my-4">

            <!-- Buttons -->
            <div class="d-flex gap-2 flex-wrap">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-circle"></i> Enregistrer
              </button>
              <a href="/profiles/<%= profile.id %>" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle"></i> Annuler
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include("../partials/footer") %>
