<%- include("../partials/header", { pageTitle: "Éditer mon profil", unreadCount, unreadMessages, user }) %>

<div class="container my-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">
      <div class="mb-3">
        <a href="/profiles/<%= profile.id %>" class="btn btn-outline-primary btn-sm">
          <i class="bi bi-arrow-left"></i> Retour au profil
        </a>
      </div>

      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0"><i class="bi bi-pencil-square"></i> Éditer mon profil</h4>
        </div>
        <div class="card-body">
          <form method="POST" action="/profiles/<%= profile.id %>/edit" enctype="multipart/form-data">
            <!-- Display Name -->
            <div class="mb-3">
              <label for="displayName" class="form-label">
                Nom affiché <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                id="displayName"
                name="displayName"
                value="<%= profile.displayName || '' %>"
                required
              />
            </div>

            <!-- Bio -->
            <div class="mb-3">
              <label for="bio" class="form-label">Bio</label>
              <textarea
                class="form-control"
                id="bio"
                name="bio"
                rows="4"
                maxlength="500"
                placeholder="Parlez de vous..."
              ><%= profile.bio || '' %></textarea>
              <div class="form-text">Max 500 caractères</div>
            </div>

            <!-- Location -->
            <div class="mb-3">
              <label for="location" class="form-label">
                <i class="bi bi-geo-alt"></i> Localisation
              </label>
              <input
                type="text"
                class="form-control"
                id="location"
                name="location"
                value="<%= profile.location || '' %>"
                maxlength="100"
                placeholder="Ville, Pays"
              />
            </div>

            <!-- Website -->
            <div class="mb-3">
              <label for="website" class="form-label">
                <i class="bi bi-link-45deg"></i> Site web
              </label>
              <input
                type="url"
                class="form-control"
                id="website"
                name="website"
                value="<%= profile.website || '' %>"
                maxlength="200"
                placeholder="https://example.com"
              />
            </div>

            <!-- Date of Birth -->
            <div class="mb-3">
              <label for="dateOfBirth" class="form-label">
                <i class="bi bi-calendar"></i> Date de naissance
              </label>
              <input
                type="date"
                class="form-control"
                id="dateOfBirth"
                name="dateOfBirth"
                value="<%= profile.dateOfBirth ? new Date(profile.dateOfBirth).toISOString().split('T')[0] : '' %>"
              />
            </div>

            <hr class="my-4">

            <!-- Avatar -->
            <div class="mb-3">
              <label class="form-label fw-bold">Avatar actuel</label>
              <div class="mb-2">
                <% if (profile.avatar) { %>
                  <img src="<%= profile.avatar %>" alt="Avatar" class="profile-avatar">
                <% } else { %>
                  <div class="d-flex align-items-center justify-content-center bg-secondary text-white" style="width: 100px; height: 100px; border-radius: 50%;">
                    <i class="bi bi-person-circle" style="font-size: 3rem;"></i>
                  </div>
                <% } %>
              </div>
              <label for="avatar" class="form-label">Nouveau avatar (max 5MB)</label>
              <input
                type="file"
                class="form-control"
                id="avatar"
                name="avatar"
                accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
              />
            </div>

            <!-- Banner -->
            <div class="mb-4">
              <label class="form-label fw-bold">Bannière actuelle</label>
              <div class="mb-2">
                <% if (profile.banner) { %>
                  <img src="<%= profile.banner %>" alt="Banner" style="width: 100%; max-width: 100%; height: 120px; object-fit: cover; border-radius: 8px;">
                <% } else { %>
                  <div class="d-flex align-items-center justify-content-center bg-light border rounded" style="width: 100%; height: 120px;">
                    <span class="text-muted">Aucune bannière</span>
                  </div>
                <% } %>
              </div>
              <label for="banner" class="form-label">Nouvelle bannière (max 5MB)</label>
              <input
                type="file"
                class="form-control"
                id="banner"
                name="banner"
                accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
              />
            </div>

            <!-- Buttons -->
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-circle"></i> Enregistrer
              </button>
              <a href="/profiles/<%= profile.id %>" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle"></i> Annuler
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include("../partials/footer") %>
